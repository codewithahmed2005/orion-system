<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orion System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Markdown parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">LOGIN</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">REGISTER</button>
            </div>
            
            <div id="loginForm">
                <input type="text" id="loginUsername" placeholder="Username" autocomplete="username">
                <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
                <button onclick="login()">ACCESS SYSTEM</button>
                <div class="error-msg" id="loginError"></div>
            </div>
            
            <div id="registerForm" style="display: none;">
                <input type="text" id="regUsername" placeholder="Username" autocomplete="username">
                <input type="email" id="regEmail" placeholder="Email" autocomplete="email">
                <input type="password" id="regPassword" placeholder="Password (6+ chars)" autocomplete="new-password">
                <button onclick="register()">CREATE ACCOUNT</button>
                <div class="error-msg" id="regError"></div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content settings-content">
            <div class="modal-header">
                <h3>SYSTEM SETTINGS</h3>
                <button class="close-btn" onclick="closeSettings()">‚úï</button>
            </div>
            
            <div class="settings-section">
                <h4>AI Model</h4>
                <select id="modelSelect" onchange="changeModel()">
                    <option value="mistralai/mistral-7b-instruct">Mistral 7B (Default)</option>
                    <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    <option value="anthropic/claude-3-haiku">Claude 3 Haiku</option>
                    <option value="google/gemini-pro">Gemini Pro</option>
                    <option value="meta-llama/llama-2-70b-chat">Llama 2 70B</option>
                </select>
            </div>
            
            <div class="settings-section">
                <h4>Temperature (Creativity)</h4>
                <input type="range" id="tempSlider" min="0" max="100" value="35" oninput="updateTempLabel()">
                <span id="tempLabel">0.35</span>
            </div>
            
            <div class="settings-section">
                <h4>Max Tokens</h4>
                <input type="number" id="maxTokens" value="400" min="100" max="2000" step="100">
            </div>
            
            <div class="settings-section">
                <h4>System Prompt (Optional)</h4>
                <textarea id="systemPrompt" rows="3" placeholder="Custom instructions for AI..."></textarea>
            </div>
            
            <div class="settings-section">
                <h4>Appearance</h4>
                <label class="toggle-label">
                    <input type="checkbox" id="soundToggle"> Sound Effects
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="themeToggle" onchange="toggleTheme()"> Light Mode
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="fontSizeToggle" onchange="toggleFontSize()"> Large Font
                </label>
            </div>
            
            <button onclick="saveSettings()" class="save-btn">SAVE SETTINGS</button>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content stats-content">
            <div class="modal-header">
                <h3>USAGE STATISTICS</h3>
                <button class="close-btn" onclick="closeStats()">‚úï</button>
            </div>
            <div id="statsContent">
                <div class="stat-item">
                    <span>Total Sessions:</span>
                    <span id="statSessions">-</span>
                </div>
                <div class="stat-item">
                    <span>Total Messages:</span>
                    <span id="statMessages">-</span>
                </div>
                <div class="stat-item">
                    <span>Today's Tokens:</span>
                    <span id="statTokens">-</span>
                </div>
                <div class="stat-item">
                    <span>Today's Cost:</span>
                    <span id="statCost">-</span>
                </div>
                <div id="modelStats"></div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>ORION SYSTEM</h3>
            <button class="new-chat-btn" id="newChatBtn">
                <span>+</span> NEW CHAT
            </button>
        </div>
        
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search chats..." onkeyup="searchChats(event)">
        </div>
        
        <div class="chat-list" id="chatList">
            <div class="loading-chats">Initializing...</div>
        </div>
        
        <div class="sidebar-footer">
            <button onclick="openSettings()" class="footer-btn">‚öôÔ∏è Settings</button>
            <button onclick="openStats()" class="footer-btn">üìä Stats</button>
            <button onclick="logout()" class="footer-btn logout">üö™ Logout</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-wrapper" id="mainWrapper">

        <!-- TOP BORDER -->
        <div class="svg-frame top">
            <svg viewBox="-40 0 1200 140" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <filter id="glow" x="-50%" y="-300%" width="200%" height="700%">
                        <feGaussianBlur stdDeviation="8" result="b" />
                        <feColorMatrix in="b" type="matrix" values="0 0 0 0 0 0 0 0 0 0.749 0 0 0 0 1 0 0 0 0.8 0" />
                        <feMerge>
                            <feMergeNode />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                    <filter id="glowFast" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="3" result="b" />
                        <feColorMatrix in="b" type="matrix" values="0 0 0 0 0 0 0 0 0 0.85 0 0 0 0 1 0 0 0 0.9 0" />
                        <feMerge>
                            <feMergeNode />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                    <linearGradient id="lineGrad" x1="0%" x2="100%" y1="0%" y2="0%">
                        <stop offset="0" stop-color="rgba(0,191,255,0.25)" />
                        <stop offset="0.18" stop-color="rgba(255,255,255,0.95)" />
                        <stop offset="0.5" stop-color="rgba(0,191,255,0.95)" />
                        <stop offset="0.82" stop-color="rgba(255,255,255,0.6)" />
                        <stop offset="1" stop-color="rgba(0,191,255,0.25)" />
                    </linearGradient>
                </defs>
                <g transform="translate(20,20)">
                    <g transform="translate(0,-15)" opacity="0.95">
                        <rect x="12" y="34" width="1035" height="45" rx="8" fill="rgba(0, 150, 255, 0.18)"
                            stroke="rgba(0, 200, 255, 0.65)" stroke-width="1.4"
                            style="filter: blur(3px) drop-shadow(0 0 6px rgba(0,180,255,0.8));"></rect>
                    </g>
                    <g transform="translate(0,8)" opacity="0.25">
                        <path d="M10 30 H200 l35 10 H1020 l28 -12" fill="none" stroke="rgba(0,0,0,0.6)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="10" style="filter: blur(6px);" />
                    </g>
                    <g transform="translate(0,0)" opacity="0.68">
                        <path d="M10 28 H220 l35 10 H1020 l28 -12" fill="none" stroke="url(#lineGrad)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="5" filter="url(#glow)" />
                        <path d="M10 30 H200 l35 10 H1020 l28 -12" fill="none" stroke="#bbffff" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="1.4" />
                        <g class="spark" opacity="0.55">
                            <circle cx="200" cy="28" r="4" fill="#bfffff" filter="url(#glowFast)" />
                            <circle cx="420" cy="34" r="3.2" fill="#bfffff" filter="url(#glowFast)" />
                            <rect x="640" y="24" width="6" height="2" rx="1" fill="#dffeff" transform="rotate(3 643 25)"
                                filter="url(#glowFast)" />
                        </g>
                    </g>
                    <g transform="translate(0,6)" opacity="1">
                        <path d="M10 30 H200 l35 10 H1020 l28 -12" fill="none" stroke="url(#lineGrad)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="6" filter="url(#glow)" />
                        <path d="M10 30 H200 l35 10 H1020 l28 -12" fill="none" stroke="#ffffff" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" />
                    </g>
                    <g transform="translate(0,12)" opacity="0.48">
                        <path d="M10 32 H180 l35 10 H1020 l28 -12" fill="none" stroke="rgba(0,191,255,0.35)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="4" />
                    </g>
                    <g transform="translate(430,36)" opacity="0.18">
                        <rect x="0" y="0" width="6" height="36" rx="2" fill="rgba(0,191,255,0.12)"
                            style="filter: blur(1px)" />
                        <rect x="60" y="0" width="4" height="24" rx="2" fill="rgba(0,191,255,0.10)"
                            style="filter: blur(1px)" />
                    </g>
                </g>
            </svg>
        </div>

        <!-- Toggle Sidebar Button -->
        <button class="sidebar-toggle" id="sidebarToggle" title="Toggle History">‚ò∞</button>

        <div class="main-container">
            <div class="main-content">

                <div class="system-header">
                    <span class="system-header-label" id="currentChatTitle">ORION SYSTEM</span>
                    <div class="system-ping"></div>
                    <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceInput()" title="Voice Input">üé§</button>
                </div>

                <div class="log-window" id="logWindow">
                    <div class="log-line system">
                        <span class="prefix">&gt; SYSTEM:</span> Please login to access Orion System.
                    </div>
                </div>

                <div class="console-input">
                    <span class="prompt">&gt;</span>
                    <input type="text" id="userInput" placeholder="Enter message..." autocomplete="off" disabled>
                    <button id="sendBtn" disabled>SEND</button>
                </div>

            </div>
        </div>

        <!-- BOTTOM BORDER -->
        <div class="svg-frame bottom">
            <svg viewBox="-40 0 1200 140" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <filter id="glow2" x="-50%" y="-300%" width="200%" height="700%">
                        <feGaussianBlur stdDeviation="8" result="b" />
                        <feColorMatrix in="b" type="matrix" values="0 0 0 0 0 0 0 0 0 0.749 0 0 0 0 1 0 0 0 0.8 0" />
                        <feMerge>
                            <feMergeNode />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                    <filter id="glowFast2" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="3" result="b" />
                        <feColorMatrix in="b" type="matrix" values="0 0 0 0 0 0 0 0 0 0.85 0 0 0 0 1 0 0 0 0.9 0" />
                        <feMerge>
                            <feMergeNode />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                    <linearGradient id="lineGrad2" x1="0%" x2="100%" y1="0%" y2="0%">
                        <stop offset="0" stop-color="rgba(0,191,255,0.25)" />
                        <stop offset="0.18" stop-color="rgba(255,255,255,0.95)" />
                        <stop offset="0.5" stop-color="rgba(0,191,255,0.95)" />
                        <stop offset="0.82" stop-color="rgba(255,255,255,0.6)" />
                        <stop offset="1" stop-color="rgba(0,191,255,0.25)" />
                    </linearGradient>
                </defs>
                <g transform="translate(20,20)">
                    <g transform="translate(0,-15)" opacity="0.95">
                        <rect x="-60" y="34" width="1170" height="45" rx="8" fill="rgba(0, 150, 255, 0.18)"
                            stroke="rgba(0, 200, 255, 0.65)" stroke-width="1.4"
                            style="filter: blur(3px) drop-shadow(0 0 6px rgba(0,180,255,0.8));"></rect>
                    </g>
                    <g transform="translate(0,8)" opacity="0.25">
                        <path d="M-60 30 H-50 l10 10 H1090 l28 0" fill="none" stroke="rgba(0,0,0,0.6)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="10" style="filter: blur(6px);" />
                    </g>
                    <g transform="translate(0,0)" opacity="0.68">
                        <path d="M-60 28 H-50 l10 10 H1090 l28 0" fill="none" stroke="url(#lineGrad2)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="5" filter="url(#glow2)" />
                        <path d="M-60 30 H-50 l10 10 H1090 l28 0" fill="none" stroke="#bbffff" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="1.4" />
                        <g class="spark" opacity="0.55">
                            <circle cx="200" cy="28" r="4" fill="#bfffff" filter="url(#glowFast2)" />
                            <circle cx="420" cy="34" r="3.2" fill="#bfffff" filter="url(#glowFast2)" />
                            <rect x="640" y="24" width="6" height="2" rx="1" fill="#dffeff" transform="rotate(3 643 25)"
                                filter="url(#glowFast2)" />
                        </g>
                    </g>
                    <g transform="translate(0,6)" opacity="1">
                        <path d="M-60 30 H-55 l10 10 H1090 l28 0" fill="none" stroke="url(#lineGrad2)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="6" filter="url(#glow2)" />
                        <path d="M-60 30 H-55 l10 10 H1090 l28 0" fill="none" stroke="#ffffff" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" />
                    </g>
                    <g transform="translate(0,12)" opacity="0.48">
                        <path d="M-60 32 H-50 l10 10 H1090 l28 0" fill="none" stroke="rgba(0,191,255,0.35)"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="4" />
                    </g>
                    <g transform="translate(430,36)" opacity="0.18">
                        <rect x="0" y="0" width="6" height="36" rx="2" fill="rgba(0,191,255,0.12)"
                            style="filter: blur(1px)" />
                        <rect x="60" y="0" width="4" height="24" rx="2" fill="rgba(0,191,255,0.10)"
                            style="filter: blur(1px)" />
                    </g>
                </g>
            </svg>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>
</html>
